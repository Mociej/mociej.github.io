<!DOCTYPE html>
<html>
<head>
<style>
canvas {
    background-color: "black";
}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <script>
        $(function(){
            var canvas = document.getElementById("canvas");
            var ctx = canvas.getContext("2d");     
            var leftDown = false;
            var rightDown = false;
            var offset = $("#canvas").offset();
            var oX = offset.left;
            var oY = offset.top;
            var width = 800;
            var height = 600;        
            var carX = oX + 650;
            var carY = canvas.height - 140;
            var carFloor = canvas.height - 140;
            var widthCar = 100;
            var widthWheel = 15
            var widthLine = 40;
            var heightLine = 15;
            var line = 0
            var move = 4
            var target = 0
            var action = 15;
            var objX = 0
            var objY = 0
            var widthObject = 50
            var carWindowWidth = 75
            var carWindowHeight = 25
            var jumped = 1
            var jumpAction = 5
            var bulletWidth = 10
            var points = 0
            var audio = new Audio('pewpew.mp3');
            
            function CarWindow(x, y) {
                ctx.beginPath();
                ctx.fillStyle = "blue";
                ctx.rect(x, y, carWindowWidth, carWindowHeight);
                ctx.fill();
                ctx.stroke();
            }

            function Wheel(x, y) {
                ctx.beginPath();
                ctx.fillStyle = "black";
                ctx.arc(x, y, widthWheel, 0, 2 * Math.PI);
                ctx.fill();
                ctx.stroke();
                ctx.beginPath();
                ctx.fillStyle = "silver";
                ctx.arc(x, y, widthWheel / 2, 0, 2 * Math.PI);
                ctx.fill();
                ctx.stroke();
            }

            function Wheels() {
                Wheel(carX + 20, carY + 100)
                Wheel(carX + widthCar - 20, carY + 100)
            }

            function Road(){
                ctx.beginPath();
                ctx.clearRect(0, 0, width, height);
                ctx.fillStyle = "black";
                ctx.rect(0, 0, width, height);
                ctx.fill();
                ctx.stroke();
                ctx.beginPath();
                ctx.fillStyle = "grey";
                ctx.strokeStyle = 'black';
                ctx.rect(0, 550, 800, 50);
                ctx.fill();
                ctx.stroke();
            }

            function carAction(m) {
                carX += m       
                
                ctx.beginPath();
                ctx.fillStyle = "yellow";
                ctx.rect(carX, carY, widthCar, widthCar);
                ctx.fill();
                ctx.stroke();
                Wheels();
                CarWindow(carX, carY+10);
            }

            function Sides(x, y) {
                ctx.beginPath();
                ctx.fillStyle = "white";
                ctx.rect(y, x, widthLine, heightLine);
                ctx.fill();
                ctx.stroke();
                ctx.beginPath();
                ctx.fillStyle = "red";
                ctx.rect(y + widthLine, x, widthLine, heightLine);
                ctx.fill();
                ctx.stroke();
            }
            
            function Center(x, y) {
                ctx.beginPath();
                ctx.fillStyle = "white";
                ctx.rect(y, x, widthLine, heightLine);
                ctx.fill();
                ctx.stroke();
            }

            function Obj() {
                objX = 0;  
                objY = Math.floor(Math.random() * 200) + 350;
               
                target = 1;
            }

            function ObjDisplay() {
                if (target == 0) {
                    Obj()
                }

                ctx.beginPath();
                ctx.fillStyle = "red";
                ctx.rect(objX, objY, widthObject, widthObject);
                ctx.fill();
                ctx.stroke();

                objX += move - 0.1
                if (objX >= oX + width) {
                    target = 0
                }
            }
            function LinesDisplay() {
                for (i = line - 50; i < oY + width; i += 150) {
                    Sides(oX + 560, i);
                }
            }


            function objectHit() {
                if (carX < objX + widthObject && 
                    carX + widthCar > objX && 
                    carY <= objY + widthObject - move && 
                    carY + widthCar >= objY) {
                    return true
                }

                return false
            }

            function CarJump(y ,a) {        
                if (jumped == 1) {
                    y -= a
                    carY = y

                    if(y > (height / 2)) { 
                        setTimeout(function() {
                            requestAnimationFrame(function() {
                                CarJump(y,a);
                            }
                        )}, 1);          
                    } else {
                        setTimeout(function() {
                            requestAnimationFrame(function() {
                                CarJump(y,-a);
                            }
                        )}, 1); 
                    } 
                }
                
                if(y > carFloor){
                    carY = carFloor
                    jumped = 0
                    return;
                }

            }
            function shootedObj(x, y) {
                if (x  < objX + widthObject && x + bulletWidth > objX && y < objY + widthObject && y + bulletWidth > objY ) {
                    target = 0;
                    points += 10;
                    return true
                }
                return false
            }

            function Fire(x,y) {
                ctx.beginPath();
                ctx.fillStyle = "yellow";
                x -= action
                ctx.arc(x, y, bulletWidth , 0, 2 * Math.PI);
                ctx.fill()
                ctx.closePath();

                if (x > oX) {      
                    setTimeout(function() {
                        requestAnimationFrame(function() {
                            if (shootedObj(x, y)) {
                                return 
                            }
                            playSound();   
                            Fire(x, y);
                        }
                    )}, 1);
                }
            }

            function playSound(){
                audio.play();
            }

            function ScoreTable() {
                ctx.beginPath();            
                ctx.fillStyle = "white" 
                ctx.font = "20px Times New Roman";             
                ctx.fillText("Points: " + points , 10, 30);
                ctx.stroke();
            }

            function start() {
                if (line > 150) {
                    line = 0
                    move += 0.1
                }
                line += move

                if (objectHit()) {
                    return
                }

                Road();
                LinesDisplay();
                ObjDisplay();
                carAction(0);
                ScoreTable();
                
                if (leftDown) {
                    if (carX > oX)
                        carAction(-action);                     
                } else if (rightDown) {
                    if (carX < (canvas.width - widthCar))
                        carAction(action);                   
                }
                requestAnimationFrame(start);
            }

            document.onkeydown = keyDown;
            document.onkeyup = keyUp;

            function keyDown(e) {
                e = e || window.event;

                if (e.keyCode == '37') 
                        leftDown = true            
                else if (e.keyCode == '39') 
                    rightDown = true
                else if (e.keyCode == '32') { 
                    jumped = 1
                    CarJump(carY,jumpAction);
                }
                else if (e.keyCode == '67') { 
                    if(audio.paused)
                        Fire(carX - widthCar/2 + widthCar/3, carY + widthCar);    
                }  
                               
            }

            function keyUp(e) {
                if (e.keyCode == '37')
                    leftDown = false;           
                else if (e.keyCode == '39') 
                    rightDown = false;            
            }

            start();
        });


    </script>
    <canvas id="canvas" width=800 height=600>
    </canvas>
</body>
</html>